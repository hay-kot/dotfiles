# ─────────────────────────────────────────────────────────────
# General Settings
# ─────────────────────────────────────────────────────────────
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 50000
set -g escape-time 0
set -g focus-events on
set -g status-interval 1

# ─────────────────────────────────────────────────────────────
# Prefix Key
# ─────────────────────────────────────────────────────────────
set -g prefix C-Space
bind C-Space send-prefix

# ─────────────────────────────────────────────────────────────
# Pane Navigation (vim-style)
# ─────────────────────────────────────────────────────────────
# Alt+hjkl without prefix (like zellij)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# ─────────────────────────────────────────────────────────────
# Pane Splitting (intuitive keys)
# ─────────────────────────────────────────────────────────────
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# ─────────────────────────────────────────────────────────────
# Pane Resizing
# ─────────────────────────────────────────────────────────────
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

bind -n M-= resize-pane -Z  # Alt+= for zoom (like Alt++ fullscreen)

# ─────────────────────────────────────────────────────────────
# Window (Tab) Management
# ─────────────────────────────────────────────────────────────
bind -n M-t new-window -c "#{pane_current_path}"  # Alt+t new tab
bind -n M-Tab next-window                          # Alt+Tab next
bind -n M-n split-window -h -c "#{pane_current_path}"  # Alt+n new pane (like zellij)

# ─────────────────────────────────────────────────────────────
# Copy Mode (vim-style)
# ─────────────────────────────────────────────────────────────
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Escape send -X cancel

# ─────────────────────────────────────────────────────────────
# Custom: Lazygit Popup (Alt+g)
# ─────────────────────────────────────────────────────────────
bind -n M-g display-popup -E -w 80% -h 80% "lazygit"

# ─────────────────────────────────────────────────────────────
# Custom: Session Picker (prefix + f)
# ─────────────────────────────────────────────────────────────
bind f display-popup -E -w 60% -h 60% "tmux list-sessions -F '#S' | fzf --reverse | xargs -I{} tmux switch-client -t {}"

# ─────────────────────────────────────────────────────────────
# Custom: Hive TUI (prefix + Space)
# ─────────────────────────────────────────────────────────────
bind Space display-popup -E -w 85% -h 85% "HIVE_POPUP=true hive"

# ─────────────────────────────────────────────────────────────
# Custom: Perles Popup (prefix + b)
# ─────────────────────────────────────────────────────────────
bind b display-popup -E -w 80% -h 80% "perles"

# ─────────────────────────────────────────────────────────────
# Session Navigation (prefix + number to switch to Nth session)
# ─────────────────────────────────────────────────────────────
bind 1 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '1p')"
bind 2 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '2p')"
bind 3 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '3p')"
bind 4 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '4p')"
bind 5 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '5p')"
bind 6 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '6p')"
bind 7 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '7p')"
bind 8 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '8p')"
bind 9 run-shell "tmux switch-client -t $(tmux list-sessions -F '#S' | sed -n '9p')"

# ─────────────────────────────────────────────────────────────
# Status Bar
# ─────────────────────────────────────────────────────────────
set -g status-position top

# ─────────────────────────────────────────────────────────────
# Plugins
# ─────────────────────────────────────────────────────────────
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Session resurrection settings
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'  # Save every 15 minutes

set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'janoamaral/tokyo-night-tmux'

# tokyo-night theme options (minimal like zellij compact-bar)
set -g @tokyo-night-tmux_show_datetime 0
set -g @tokyo-night-tmux_show_path 0
set -g @tokyo-night-tmux_show_git 0
set -g @tokyo-night-tmux_show_panes 0
set -g @tokyo-night-tmux_window_id_style none
set -g @tokyo-night-tmux_pane_id_style none
set -g @tokyo-night-tmux_zoom_id_style none

bind l switch-client -t hive

# Initialize TPM (keep at bottom)
run '~/.config/tmux/plugins/tpm/tpm'


