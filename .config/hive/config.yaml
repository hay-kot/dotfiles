version: 0.2.0
git_path: git

commands:
  spawn:
    # zellij without layout:
    # - >-
    #   new_pane_id=$(wezterm cli spawn --cwd "{{ .Path }}" -- zellij attach "{{ .Name }}" -c)
    #   && wezterm cli set-tab-title --pane-id="$new_pane_id" '{{ .Name }}'
    - >-
      new_pane_id=$(wezterm cli spawn --cwd "{{ .Path }}" -- zellij --layout ~/.config/zellij/layouts/hive.kdl attach --create "{{ .Name }}")
      && wezterm cli set-tab-title --pane-id="$new_pane_id" '{{ .Name }}'
  batch_spawn:
    - >-
      new_pane_id=$(wezterm cli spawn --cwd "{{ .Path }}" -- zellij attach "{{ .Name }}" -c)
      && wezterm cli set-tab-title --pane-id="$new_pane_id" '{{ .Name }}'
      && sleep 0.3
      && zellij -s "{{ .Name }}" action write-chars "claude '{{ .Prompt }}'"
      && zellij -s "{{ .Name }}" action write 13

rules:
  - pattern: ""
    commands:
      - hive ctx init
  - pattern: ".*[:/]grafana/.*"
    commands:
      - mise trust
  - pattern: ".*[:/]hay-kot/.*"
    commands:
      - mise trust
  - pattern: ".*[:/]hay-kot/recipinned"
    commands:
      - task dep:sync
      - task pc:install
  - pattern: ".*[:/]hay-kot/mealie"
    commands:
      - task setup

keybindings:
  enter:
    help: focus or open zellij session
    sh: >-
      pane_id=$(wezterm cli list --format json | jq -r '.[] | select(.tab_title == "{{ .Name }}") | .pane_id' | head -1)
      && [ -n "$pane_id" ]
      && wezterm cli activate-pane --pane-id "$pane_id"
      || { new_pane_id=$(wezterm cli spawn --cwd "{{ .Path }}" -- zellij --layout ~/.config/zellij/layouts/hive.kdl attach --create "{{ .Name }}")
      && wezterm cli set-tab-title --pane-id="$new_pane_id" '{{ .Name }}'; }
  ctrl+d:
    help: kill zellij session
    sh: zellij kill-session "{{ .Name }}" 2>/dev/null || true
